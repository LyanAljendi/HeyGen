<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LiveAvatar Voice Chat</title>

  <!-- Correct LiveKit client SDK from jsdelivr -->
  <script src="https://cdn.jsdelivr.net/npm/livekit-client/dist/livekit-client.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 2rem;
    }
    video {
      width: 480px;
      height: 360px;
      border: 2px solid #444;
      margin-top: 1rem;
      background: black;
    }
    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      margin-top: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Talk to Your LiveAvatar</h1>

  <video id="remoteVideo" autoplay playsinline></video>
  <br />
  <button id="startBtn">Start Voice Chat</button>

  <script>
    // ðŸ”§ CONFIGURATION â€” Replace these with your real values
    const LIVEKIT_URL = "wss://chatham-6f5vepem.livekit.cloud"; // your LiveKit server
    const ROOM_NAME = "test-room";  
    const TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJicm93c2VyLXRva2VuIiwiaXNzIjoiQVBJQ0FzSmFhOVY1RG5rIiwic3ViIjoidXNlcjEiLCJpYXQiOjE3NzA2NTA2NzQsImV4cCI6MTc3MDY1NDI3NCwicm9vbSI6InRlc3Qtcm9vbSIsInJvb21fam9pbiI6dHJ1ZX0.mVQdhq-gswd-YO8FaVAbV-rEzPBiPcsByNMw3id5yHI"; // token generated from Python agent

    let room;

    document.getElementById("startBtn").onclick = async () => {
      const startBtn = document.getElementById("startBtn");
      startBtn.disabled = true;
      startBtn.innerText = "Connecting...";

      try {
        // 1) Create Room instance
        room = new LivekitClient.Room();

        // 2) Connect to LiveKit
        await room.connect(LIVEKIT_URL, TOKEN, { 
          room: ROOM_NAME,
          autoSubscribe: true
        });
        console.log("Connected to room:", ROOM_NAME);
        startBtn.innerText = "Connected! Recording audioâ€¦";

        // 3) Listen for remote tracks (avatar video / audio)
        room.on(LivekitClient.RoomEvent.TrackSubscribed, (track, publication, participant) => {
          if (track.kind === "video" || track.kind === "audio") {
            const el = track.attach();
            document.getElementById("remoteVideo").replaceWith(el);
          }
        });

        // 4) Capture and publish microphone audio
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        for (const track of stream.getAudioTracks()) {
          await room.localParticipant.publishTrack(track);
        }

      } catch (err) {
        console.error("Connection failed:", err);
        startBtn.innerText = "Connection Failed â€” See Console";
      }
    };
  </script>
</body>
</html>



